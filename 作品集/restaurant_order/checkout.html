<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>çµå¸³ç®¡ç† - é¤å»³ç®¡ç†ç³»çµ±</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        /* åŸºæœ¬æ¨£å¼ */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
            color: #2c3e50;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        /* é ‚éƒ¨å°èˆª */
        .header {
            background: rgba(255, 255, 255, 0.95);
            padding: 20px;
            border-radius: 15px;
            margin-bottom: 20px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
            backdrop-filter: blur(10px);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .header h1 {
            color: #2c3e50;
            font-size: 1.8em;
        }

        .nav-links {
            display: flex;
            gap: 15px;
        }

        .nav-link {
            color: #4a5568;
            text-decoration: none;
            padding: 8px 16px;
            border-radius: 8px;
            transition: all 0.3s ease;
            font-weight: 500;
            background: none;
            border: none;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .nav-link:hover {
            background: #edf2f7;
            color: #2d3748;
        }

        /* çµ±è¨ˆå¡ç‰‡å€åŸŸ */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: white;
            padding: 25px;
            border-radius: 15px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
            text-align: center;
            transition: all 0.3s ease;
            cursor: pointer;
            position: relative;
            overflow: hidden;
        }

        .stat-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 4px;
            background: linear-gradient(45deg, #4a90e2, #357abd);
        }

        .stat-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
        }

        .stat-number {
            font-size: 2.8em;
            font-weight: bold;
            margin: 10px 0;            background: linear-gradient(45deg, #4a90e2, #357abd);
            -webkit-background-clip: text;
            background-clip: text;
            -webkit-text-fill-color: transparent;
            color: transparent;
            line-height: 1.2;
        }

        .stat-label {
            font-size: 1.1em;
            color: #718096;
            margin-top: 5px;
        }

        /* è¨‚å–®å€åŸŸ */
        .orders-section {
            background: white;
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 30px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
            opacity: 0;
            transform: translateY(20px);
            transition: all 0.3s ease;
        }

        .orders-section.visible {
            opacity: 1;
            transform: translateY(0);
        }

        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 2px solid #edf2f7;
        }

        .section-title {
            font-size: 1.5em;
            font-weight: 600;
            color: #2d3748;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        /* è¨‚å–®å¡ç‰‡ */
        .order-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
        }

        .order-card {
            background: #f8fafc;
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
            transition: all 0.3s ease;
            border-left: 4px solid #4a90e2;
            opacity: 0;
            transform: translateY(20px);
            animation: fadeInUp 0.5s forwards;
        }

        @keyframes fadeInUp {
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .order-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        }

        .order-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .order-id {
            font-weight: 600;
            color: #2d3748;
            font-size: 1.1em;
        }

        .order-time {
            color: #718096;
            font-size: 0.9em;
        }

        .order-items {
            margin: 15px 0;
            max-height: 200px;
            overflow-y: auto;
            padding-right: 5px;
        }

        .order-items::-webkit-scrollbar {
            width: 4px;
        }

        .order-items::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 2px;
        }

        .order-items::-webkit-scrollbar-thumb {
            background: #cbd5e0;
            border-radius: 2px;
        }

        .order-item {
            display: flex;
            justify-content: space-between;
            padding: 8px 0;
            border-bottom: 1px solid #edf2f7;
        }

        .order-item:last-child {
            border-bottom: none;
        }

        .item-name {
            color: #4a5568;
            flex-grow: 1;
            padding-right: 15px;
        }

        .item-quantity {
            color: #718096;
            font-weight: 500;
        }

        .order-total {
            text-align: right;
            margin-top: 15px;
            padding-top: 15px;
            border-top: 2px solid #edf2f7;
            font-weight: 600;
            color: #2d3748;
            font-size: 1.1em;
        }

        .order-actions {
            display: flex;
            justify-content: flex-end;
            gap: 10px;
            margin-top: 15px;
            padding-top: 15px;
            border-top: 1px solid #edf2f7;
        }

        .btn {
            padding: 8px 16px;
            border-radius: 8px;
            border: none;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 0.95em;
        }

        .btn-primary {
            background: linear-gradient(45deg, #4a90e2, #357abd);
            color: white;
        }

        .btn-primary:hover {
            background: linear-gradient(45deg, #357abd, #2868a5);
            transform: translateY(-1px);
        }

        .btn i {
            font-size: 0.9em;
        }

        /* æ²’æœ‰è¨‚å–®æ™‚çš„é¡¯ç¤º */
        .no-orders {
            text-align: center;
            padding: 40px;
            color: #718096;
            font-size: 1.1em;
            background: #f8fafc;
            border-radius: 12px;
            border: 2px dashed #e2e8f0;
        }

        /* è¼‰å…¥å‹•ç•« */
        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .loading {
            animation: spin 1s linear infinite;
        }

        /* éŸ¿æ‡‰å¼è¨­è¨ˆ */
        @media (max-width: 768px) {
            .stats-grid {
                grid-template-columns: repeat(2, 1fr);
            }

            .order-grid {
                grid-template-columns: 1fr;
            }

            .header {
                padding: 15px;
            }

            .header h1 {
                font-size: 1.5em;
            }

            .orders-section {
                padding: 15px;
            }
        }

        @media (max-width: 480px) {
            .stats-grid {
                grid-template-columns: 1fr;
            }

            .header {
                flex-direction: column;
                gap: 15px;
                text-align: center;
            }

            .nav-links {
                width: 100%;
                justify-content: center;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- é ‚éƒ¨å°èˆª -->
        <header class="header">
            <h1>çµå¸³ç®¡ç†</h1>
            <nav class="nav-links">
                <a href="admin.html" class="nav-link">
                    <i class="fas fa-home"></i> è¿”å›ç®¡ç†
                </a>
                <button class="nav-link" onclick="refreshData()">
                    <i class="fas fa-sync-alt"></i> é‡æ–°æ•´ç†
                </button>
            </nav>
        </header>

        <!-- çµ±è¨ˆå¡ç‰‡ -->
        <div class="stats-grid">
            <div class="stat-card" onclick="togglePendingOrders()">
                <div class="stat-number" id="pendingCount">0</div>
                <div class="stat-label">å¾…çµå¸³ ğŸ‘†</div>
            </div>
            <div class="stat-card" onclick="toggleCompletedOrders()">
                <div class="stat-number" id="completedCount">0</div>
                <div class="stat-label">å·²çµå¸³ ğŸ‘†</div>
            </div>
        </div>

        <!-- å¾…çµå¸³è¨‚å–®å€åŸŸ -->
        <section id="pendingOrdersSection" class="orders-section" style="display: none;">
            <div class="section-header">
                <h2 class="section-title">
                    <i class="fas fa-clock"></i>
                    å¾…çµå¸³è¨‚å–®
                </h2>
            </div>
            <div id="pendingOrdersGrid" class="order-grid">
                <!-- è¨‚å–®å°‡å‹•æ…‹æ’å…¥é€™è£¡ -->
            </div>
        </section>

        <!-- å·²çµå¸³è¨‚å–®å€åŸŸ -->
        <section id="completedOrdersSection" class="orders-section" style="display: none;">
            <div class="section-header">
                <h2 class="section-title">
                    <i class="fas fa-check-circle"></i>
                    å·²çµå¸³è¨‚å–®
                </h2>
            </div>
            <div id="completedOrdersGrid" class="order-grid">
                <!-- è¨‚å–®å°‡å‹•æ…‹æ’å…¥é€™è£¡ -->
            </div>
        </section>
    </div>

    <script>
        // å…¨åŸŸè®Šæ•¸
        let orders = [];
        let lastUpdate = new Date();

        // è¼‰å…¥åˆå§‹è³‡æ–™
        document.addEventListener('DOMContentLoaded', function() {
            loadOrders();
            updateStats();
            // æ¯30ç§’è‡ªå‹•åˆ·æ–°ä¸€æ¬¡
            setInterval(refreshData, 30000);
            
            // ç›£è½ localStorage è®ŠåŒ–
            window.addEventListener('storage', function(e) {
                if (e.key === 'restaurant_orders') {
                    refreshData();
                }
            });
        });

        // åˆ·æ–°è³‡æ–™
        function refreshData() {
            loadOrders();
            updateStats();
            
            // é¡¯ç¤ºé‡æ–°æ•´ç†å‹•ç•«
            const refreshIcon = document.querySelector('.fa-sync-alt');
            refreshIcon.classList.add('loading');
            setTimeout(() => {
                refreshIcon.classList.remove('loading');
            }, 1000);
        }

        // è¼‰å…¥è¨‚å–®è³‡æ–™
        function loadOrders() {
            const storedOrders = localStorage.getItem('restaurant_orders');
            orders = storedOrders ? JSON.parse(storedOrders) : [];
            lastUpdate = new Date();

            // æ›´æ–°é¡¯ç¤º
            if (document.getElementById('pendingOrdersSection').style.display !== 'none') {
                displayPendingOrders();
            }
            if (document.getElementById('completedOrdersSection').style.display !== 'none') {
                displayCompletedOrders();
            }
        }

        // æ›´æ–°çµ±è¨ˆ
        function updateStats() {
            const pendingCount = orders.filter(order => 
                order.status === 'completed' && !order.paid
            ).length;
            
            const completedCount = orders.filter(order => 
                order.status === 'completed' && order.paid
            ).length;

            document.getElementById('pendingCount').textContent = pendingCount;
            document.getElementById('completedCount').textContent = completedCount;
        }

        // åˆ‡æ›å¾…çµå¸³è¨‚å–®é¡¯ç¤º
        function togglePendingOrders() {
            const section = document.getElementById('pendingOrdersSection');
            if (section.style.display === 'none') {
                section.style.display = 'block';
                // æ·»åŠ å‹•ç•«é¡
                setTimeout(() => section.classList.add('visible'), 50);
                displayPendingOrders();
                section.scrollIntoView({ behavior: 'smooth' });
            } else {
                section.classList.remove('visible');
                setTimeout(() => {
                    section.style.display = 'none';
                }, 300);
            }
        }

        // åˆ‡æ›å·²çµå¸³è¨‚å–®é¡¯ç¤º
        function toggleCompletedOrders() {
            const section = document.getElementById('completedOrdersSection');
            if (section.style.display === 'none') {
                section.style.display = 'block';
                // æ·»åŠ å‹•ç•«é¡
                setTimeout(() => section.classList.add('visible'), 50);
                displayCompletedOrders();
                section.scrollIntoView({ behavior: 'smooth' });
            } else {
                section.classList.remove('visible');
                setTimeout(() => {
                    section.style.display = 'none';
                }, 300);
            }
        }

        // é¡¯ç¤ºå¾…çµå¸³è¨‚å–®
        function displayPendingOrders() {
            const container = document.getElementById('pendingOrdersGrid');
            const pendingOrders = orders.filter(order => 
                order.status === 'completed' && !order.paid
            );

            if (pendingOrders.length === 0) {
                container.innerHTML = '<div class="no-orders">ç›®å‰æ²’æœ‰å¾…çµå¸³è¨‚å–®</div>';
                return;
            }

            container.innerHTML = pendingOrders
                .sort((a, b) => new Date(b.timestamp) - new Date(a.timestamp))
                .map(order => createOrderCard(order, true))
                .join('');
        }

        // é¡¯ç¤ºå·²çµå¸³è¨‚å–®
        function displayCompletedOrders() {
            const container = document.getElementById('completedOrdersGrid');
            const completedOrders = orders.filter(order => 
                order.status === 'completed' && order.paid
            );

            if (completedOrders.length === 0) {
                container.innerHTML = '<div class="no-orders">ç›®å‰æ²’æœ‰å·²çµå¸³è¨‚å–®</div>';
                return;
            }

            container.innerHTML = completedOrders
                .sort((a, b) => new Date(b.paidAt || b.timestamp) - new Date(a.paidAt || a.timestamp))
                .map(order => createOrderCard(order, false))
                .join('');
        }

        // å‰µå»ºè¨‚å–®å¡ç‰‡
        function createOrderCard(order, showActions) {
            const orderTime = order.paidAt ? new Date(order.paidAt) : new Date(order.timestamp);
            const timeString = getRelativeTime(orderTime);

            let itemsHtml = '';
            if (Array.isArray(order.items)) {
                itemsHtml = order.items.map(item => `
                    <div class="order-item">
                        <span class="item-name">${item.name}</span>
                        <span class="item-quantity">Ã—${item.quantity}</span>
                    </div>
                `).join('');
            }

            const actionsHtml = showActions ? `
                <div class="order-actions">
                    <button class="btn btn-primary" onclick="processPayment(${order.id})">
                        <i class="fas fa-cash-register"></i> 
                        çµå¸³
                    </button>
                </div>
            ` : '';

            return `
                <div class="order-card" style="animation-delay: ${Math.random() * 0.3}s">
                    <div class="order-header">
                        <div class="order-id">è¨‚å–® #${order.id} - æ¡Œè™Ÿ ${order.tableNumber}</div>
                        <div class="order-time">${timeString}</div>
                    </div>
                    <div class="order-items">
                        ${itemsHtml}
                    </div>
                    <div class="order-total">
                        ç¸½è¨ˆ: $${order.total || 0}
                    </div>
                    ${actionsHtml}
                </div>
            `;
        }

        // è™•ç†çµå¸³
        function processPayment(orderId) {
            if (!confirm('ç¢ºèªè¦çµå¸³é€™ç­†è¨‚å–®å—ï¼Ÿ')) {
                return;
            }

            const orderIndex = orders.findIndex(order => order.id === orderId);
            if (orderIndex === -1) {
                alert('æ‰¾ä¸åˆ°è¨‚å–®');
                return;
            }

            orders[orderIndex].paid = true;
            orders[orderIndex].paidAt = new Date().toISOString();

            // æ›´æ–° localStorage
            localStorage.setItem('restaurant_orders', JSON.stringify(orders));

            // æ›´æ–°é¡¯ç¤º
            refreshData();
            alert('âœ… çµå¸³å®Œæˆï¼');
        }

        // ç²å–ç›¸å°æ™‚é–“
        function getRelativeTime(time) {
            const now = new Date();
            const diff = now - time;
            const minutes = Math.floor(diff / 60000);
            
            if (minutes < 1) return 'å‰›å‰›';
            if (minutes < 60) return `${minutes}åˆ†é˜å‰`;
            
            const hours = Math.floor(minutes / 60);
            if (hours < 24) return `${hours}å°æ™‚å‰`;
            
            return time.toLocaleDateString('zh-TW');
        }
    </script>
</body>
</html>
