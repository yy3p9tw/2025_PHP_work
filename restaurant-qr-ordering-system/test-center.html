<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸ§ª OOP æ¸¬è©¦ä¸­å¿ƒ - é¤å»³QRé»é¤ç³»çµ±</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #ff6b6b, #ffa500);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            font-weight: 700;
        }        .nav-tabs {
            display: flex;
            background: #f8f9fa;
            border-bottom: 1px solid #dee2e6;
            overflow-x: auto;
        }

        .nav-tab {
            flex: 1;
            min-width: 150px;
            padding: 15px 20px;
            border: none;
            background: transparent;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
            border-bottom: 3px solid transparent;
        }

        .nav-tab.active {
            background: white;
            border-bottom-color: #667eea;
            color: #667eea;
        }

        .nav-tab:hover:not(.active) {
            background: #e9ecef;
        }

        .tab-content {
            display: none;
            padding: 30px;
        }

        .tab-content.active {
            display: block;
        }

        .control-group {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
            margin-bottom: 30px;
        }

        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 14px;
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(102, 126, 234, 0.3);
        }

        .btn-secondary {
            background: #f8f9fa;
            color: #495057;
            border: 1px solid #dee2e6;
        }

        .btn-secondary:hover {
            background: #e9ecef;
        }

        .btn-success {
            background: #28a745;
            color: white;
        }

        .btn-info {
            background: #17a2b8;
            color: white;
        }

        .btn-warning {
            background: #ffc107;
            color: #212529;
        }

        .stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: white;
            padding: 20px;
            border-radius: 12px;
            text-align: center;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
            border: 1px solid #e9ecef;
        }

        .stat-number {
            font-size: 2.5em;
            font-weight: 700;
            margin-bottom: 8px;
        }

        .stat-number.success { color: #28a745; }
        .stat-number.danger { color: #dc3545; }
        .stat-number.info { color: #17a2b8; }
        .stat-number.warning { color: #ffc107; }

        .log-container {
            background: #1e1e1e;
            color: #ffffff;
            padding: 20px;
            border-radius: 8px;
            max-height: 500px;
            overflow-y: auto;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            line-height: 1.4;
        }

        .log-entry {
            margin-bottom: 5px;
            padding: 5px 10px;
            border-radius: 4px;
        }

        .log-entry.success {
            background: rgba(81, 207, 102, 0.2);
            color: #51cf66;
        }

        .log-entry.error {
            background: rgba(255, 107, 107, 0.2);
            color: #ff6b6b;
        }

        .log-entry.info {
            background: rgba(102, 126, 234, 0.2);
            color: #667eea;
        }

        .log-entry.warning {
            background: rgba(255, 193, 7, 0.2);
            color: #ffc107;
        }

        .progress-bar {
            width: 100%;
            height: 8px;
            background: #e9ecef;
            border-radius: 4px;
            overflow: hidden;
            margin: 20px 0;
        }        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #667eea, #764ba2);
            width: 0%;
            transition: width 0.3s ease;
        }

        .file-list {
            margin: 15px 0;
        }

        .file-item {
            display: flex;
            align-items: center;
            padding: 10px;
            margin: 5px 0;
            background: white;
            border-radius: 6px;
            border-left: 4px solid #ccc;
        }

        .file-item.marked-for-deletion {
            border-left-color: #dc3545;
            background: #fff5f5;
        }

        .file-name {
            flex: 1;
            font-family: monospace;
            font-weight: bold;
        }

        .file-status {
            margin: 0 15px;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 0.9em;
        }

        .file-status.active {
            background: #d4edda;
            color: #155724;
        }

        .file-status.obsolete {
            background: #f8d7da;
            color: #721c24;
        }

        .file-actions {
            margin-top: 15px;
            text-align: center;
        }

        .btn-sm {
            padding: 4px 8px;
            font-size: 0.8em;
        }

        .dependency-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
            margin-bottom: 30px;
        }

        .dependency-card {
            padding: 15px;
            border-radius: 8px;
            border: 1px solid #dee2e6;
            background: #f8f9fa;
        }

        .dependency-card.loaded {
            background: #d4edda;
            border-color: #c3e6cb;
        }

        .dependency-card.failed {
            background: #f8d7da;
            border-color: #f5c6cb;
        }

        .status-indicator {
            display: inline-block;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            margin-right: 8px;
        }

        .status-indicator.success { background: #28a745; }
        .status-indicator.error { background: #dc3545; }
        .status-indicator.warning { background: #ffc107; }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ§ª OOP æ¸¬è©¦ä¸­å¿ƒ</h1>
            <p>é¤å»³QRé»é¤ç³»çµ± - çµ±ä¸€æ¸¬è©¦å¹³å°</p>
        </div>        <div class="nav-tabs">
            <button class="nav-tab active" onclick="switchTab('dependency')">ğŸ” ä¾è³´æª¢æŸ¥</button>
            <button class="nav-tab" onclick="switchTab('basic')">ğŸ§ª åŸºæœ¬æ¸¬è©¦</button>
            <button class="nav-tab" onclick="switchTab('core')">âš¡ æ ¸å¿ƒæ¨¡çµ„</button>
            <button class="nav-tab" onclick="switchTab('performance')">ğŸ“Š æ•ˆèƒ½ç›£æ§</button>
            <button class="nav-tab" onclick="switchTab('full')">ğŸš€ å®Œæ•´æ¸¬è©¦</button>
        </div>

        <!-- ä¾è³´æª¢æŸ¥é ç±¤ -->
        <div id="dependency-tab" class="tab-content active">
            <h2>ğŸ” ä¾è³´ç’°å¢ƒæª¢æŸ¥</h2>
            <div class="control-group">
                <button class="btn btn-info" onclick="checkDependencies()">æª¢æŸ¥ä¾è³´</button>
                <button class="btn btn-secondary" onclick="clearLog('dependency')">æ¸…é™¤æ—¥èªŒ</button>
            </div>
            
            <div class="dependency-grid" id="dependency-grid">
                <!-- å‹•æ…‹ç”Ÿæˆä¾è³´å¡ç‰‡ -->
            </div>
            
            <div id="dependency-log" class="log-container">
                <div class="log-entry info">ğŸ¯ é»æ“Šã€Œæª¢æŸ¥ä¾è³´ã€é–‹å§‹æª¢æŸ¥æ¸¬è©¦ç’°å¢ƒ</div>
            </div>
        </div>

        <!-- åŸºæœ¬æ¸¬è©¦é ç±¤ -->
        <div id="basic-tab" class="tab-content">
            <h2>ğŸ§ª åŸºæœ¬åŠŸèƒ½æ¸¬è©¦</h2>
            <div class="control-group">
                <button class="btn btn-success" onclick="runBasicTests()">é‹è¡ŒåŸºæœ¬æ¸¬è©¦</button>
                <button class="btn btn-secondary" onclick="clearLog('basic')">æ¸…é™¤æ—¥èªŒ</button>
            </div>
            
            <div class="stats" id="basic-stats" style="display: none;">
                <div class="stat-card">
                    <div class="stat-number success" id="basic-passed">0</div>
                    <div class="stat-label">é€šé</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number danger" id="basic-failed">0</div>
                    <div class="stat-label">å¤±æ•—</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number info" id="basic-total">0</div>
                    <div class="stat-label">ç¸½è¨ˆ</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number warning" id="basic-rate">0%</div>
                    <div class="stat-label">é€šéç‡</div>
                </div>
            </div>
            
            <div id="basic-log" class="log-container">
                <div class="log-entry info">ğŸ¯ é»æ“Šã€Œé‹è¡ŒåŸºæœ¬æ¸¬è©¦ã€é–‹å§‹æ¸¬è©¦æ¡†æ¶åŸºæœ¬åŠŸèƒ½</div>
            </div>
        </div>

        <!-- æ ¸å¿ƒæ¨¡çµ„æ¸¬è©¦é ç±¤ -->
        <div id="core-tab" class="tab-content">
            <h2>âš¡ æ ¸å¿ƒæ¨¡çµ„æ¸¬è©¦</h2>
            <div class="control-group">
                <button class="btn btn-primary" onclick="runCoreTests()">é‹è¡Œæ ¸å¿ƒæ¸¬è©¦</button>
                <button class="btn btn-secondary" onclick="clearLog('core')">æ¸…é™¤æ—¥èªŒ</button>
            </div>
            
            <div class="stats" id="core-stats" style="display: none;">
                <div class="stat-card">
                    <div class="stat-number success" id="core-passed">0</div>
                    <div class="stat-label">é€šé</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number danger" id="core-failed">0</div>
                    <div class="stat-label">å¤±æ•—</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number info" id="core-total">0</div>
                    <div class="stat-label">ç¸½è¨ˆ</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number warning" id="core-rate">0%</div>
                    <div class="stat-label">é€šéç‡</div>
                </div>
            </div>
            
            <div id="core-log" class="log-container">
                <div class="log-entry info">ğŸ¯ é»æ“Šã€Œé‹è¡Œæ ¸å¿ƒæ¸¬è©¦ã€é–‹å§‹æ¸¬è©¦ EventBusã€ErrorHandlerã€CartManager</div>
            </div>        </div>

        <!-- æ•ˆèƒ½ç›£æ§é ç±¤ -->
        <div id="performance-tab" class="tab-content">
            <h2>ğŸ“Š æ•ˆèƒ½ç›£æ§æ¸¬è©¦</h2>
            <div class="control-group">
                <button class="btn btn-info" onclick="startPerformanceMonitor()">é–‹å§‹ç›£æ§</button>
                <button class="btn btn-warning" onclick="runPerformanceTest()">åŸ·è¡Œæ•ˆèƒ½æ¸¬è©¦</button>
                <button class="btn btn-secondary" onclick="clearLog('performance')">æ¸…é™¤æ—¥èªŒ</button>
            </div>
            
            <div class="stats" id="performance-stats" style="display: none;">
                <div class="stat-card">
                    <div class="stat-number info" id="perf-memory">0 MB</div>
                    <div class="stat-label">è¨˜æ†¶é«”ä½¿ç”¨</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number info" id="perf-execution">0 ms</div>
                    <div class="stat-label">åŸ·è¡Œæ™‚é–“</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number info" id="perf-operations">0</div>
                    <div class="stat-label">æ“ä½œæ¬¡æ•¸</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number warning" id="perf-fps">0</div>
                    <div class="stat-label">FPS</div>
                </div>
            </div>
            
            <div id="performance-log" class="log-container">
                <div class="log-entry info">ğŸ“Š é»æ“Šã€Œé–‹å§‹ç›£æ§ã€å•Ÿå‹•æ•ˆèƒ½ç›£æ§</div>
            </div>
        </div>        <!-- å®Œæ•´æ¸¬è©¦é ç±¤ -->
        <div id="full-tab" class="tab-content">
            <h2>ğŸš€ å®Œæ•´æ¸¬è©¦å¥—ä»¶</h2>
            <div class="control-group">
                <button class="btn btn-primary" onclick="runFullTests()">é‹è¡Œå®Œæ•´æ¸¬è©¦</button>
                <button class="btn btn-warning" onclick="runAllSequentially()">ä¾åºåŸ·è¡Œæ‰€æœ‰æ¸¬è©¦</button>
                <button class="btn btn-info" onclick="showTestFileManagement()">ç®¡ç†æ¸¬è©¦æª”æ¡ˆ</button>
                <button class="btn btn-secondary" onclick="clearLog('full')">æ¸…é™¤æ—¥èªŒ</button>
            </div>
            
            <!-- æ¸¬è©¦æª”æ¡ˆç®¡ç†å€åŸŸ -->
            <div id="test-file-management" style="display: none; margin: 20px 0; padding: 20px; background: #f8f9fa; border-radius: 8px;">
                <h3>ğŸ“ æ¸¬è©¦æª”æ¡ˆç®¡ç†</h3>
                <p>ä»¥ä¸‹æ˜¯ç³»çµ±ä¸­çš„æ¸¬è©¦ç›¸é—œæª”æ¡ˆï¼š</p>
                <div class="file-list">
                    <div class="file-item">
                        <span class="file-name">test-center.html</span>
                        <span class="file-status active">âœ… ä¸»è¦æ¸¬è©¦ä¸­å¿ƒï¼ˆä¿ç•™ï¼‰</span>
                    </div>
                    <div class="file-item">
                        <span class="file-name">test-suite.html</span>
                        <span class="file-status obsolete">ğŸ—‘ï¸ å¯ç§»é™¤ï¼ˆåŠŸèƒ½å·²æ•´åˆï¼‰</span>
                        <button class="btn btn-sm btn-danger" onclick="markForDeletion('test-suite.html')">æ¨™è¨˜åˆªé™¤</button>
                    </div>
                    <div class="file-item">
                        <span class="file-name">test-suite-fixed.html</span>
                        <span class="file-status obsolete">ğŸ—‘ï¸ å¯ç§»é™¤ï¼ˆåŠŸèƒ½å·²æ•´åˆï¼‰</span>
                        <button class="btn btn-sm btn-danger" onclick="markForDeletion('test-suite-fixed.html')">æ¨™è¨˜åˆªé™¤</button>
                    </div>
                    <div class="file-item">
                        <span class="file-name">simple-test.html</span>
                        <span class="file-status obsolete">ğŸ—‘ï¸ å¯ç§»é™¤ï¼ˆåŠŸèƒ½å·²æ•´åˆï¼‰</span>
                        <button class="btn btn-sm btn-danger" onclick="markForDeletion('simple-test.html')">æ¨™è¨˜åˆªé™¤</button>
                    </div>
                    <div class="file-item">
                        <span class="file-name">dependency-check.html</span>
                        <span class="file-status obsolete">ğŸ—‘ï¸ å¯ç§»é™¤ï¼ˆåŠŸèƒ½å·²æ•´åˆï¼‰</span>
                        <button class="btn btn-sm btn-danger" onclick="markForDeletion('dependency-check.html')">æ¨™è¨˜åˆªé™¤</button>
                    </div>
                    <div class="file-item">
                        <span class="file-name">errorhandler-test.html</span>
                        <span class="file-status obsolete">ğŸ—‘ï¸ å¯ç§»é™¤ï¼ˆåŠŸèƒ½å·²æ•´åˆï¼‰</span>
                        <button class="btn btn-sm btn-danger" onclick="markForDeletion('errorhandler-test.html')">æ¨™è¨˜åˆªé™¤</button>
                    </div>
                    <div class="file-item">
                        <span class="file-name">performance-monitor.html</span>
                        <span class="file-status obsolete">ğŸ—‘ï¸ å¯ç§»é™¤ï¼ˆåŠŸèƒ½å·²æ•´åˆï¼‰</span>
                        <button class="btn btn-sm btn-danger" onclick="markForDeletion('performance-monitor.html')">æ¨™è¨˜åˆªé™¤</button>
                    </div>
                </div>
                <div class="file-actions">
                    <button class="btn btn-warning" onclick="cleanupTestFiles()">æ¸…ç†æ¨™è¨˜çš„æª”æ¡ˆ</button>
                    <button class="btn btn-secondary" onclick="hideTestFileManagement()">é—œé–‰</button>
                </div>
            </div>
            
            <div class="progress-bar" id="full-progress-container" style="display: none;">
                <div class="progress-fill" id="full-progress"></div>
            </div>
            
            <div class="stats" id="full-stats" style="display: none;">
                <div class="stat-card">
                    <div class="stat-number success" id="full-passed">0</div>
                    <div class="stat-label">é€šé</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number danger" id="full-failed">0</div>
                    <div class="stat-label">å¤±æ•—</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number info" id="full-total">0</div>
                    <div class="stat-label">ç¸½è¨ˆ</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number warning" id="full-rate">0%</div>
                    <div class="stat-label">é€šéç‡</div>
                </div>
            </div>
              <div id="full-log" class="log-container">
                <div class="log-entry info">ğŸ¯ é»æ“Šã€Œé‹è¡Œå®Œæ•´æ¸¬è©¦ã€åŸ·è¡Œæ‰€æœ‰æ¸¬è©¦æ¡ˆä¾‹</div>
            </div>
        </div>
    </div>

    <!-- æ•´åˆèªªæ˜ -->
    <div class="container" style="margin-top: 20px;">
        <div style="padding: 20px; background: #f8f9fa; border-radius: 12px; border-left: 4px solid #28a745;">
            <h3 style="color: #28a745; margin-bottom: 15px;">ğŸ¯ æ¸¬è©¦ä¸­å¿ƒæ•´åˆèªªæ˜</h3>
            <p style="margin-bottom: 10px;">
                <strong>æ­¤æ¸¬è©¦ä¸­å¿ƒæ•´åˆäº†æ‰€æœ‰æ¸¬è©¦åŠŸèƒ½ï¼š</strong>
            </p>
            <ul style="margin-left: 20px; line-height: 1.6;">
                <li><strong>ä¾è³´æª¢æŸ¥ï¼š</strong>æ•´åˆäº† dependency-check.html çš„åŠŸèƒ½</li>
                <li><strong>åŸºæœ¬æ¸¬è©¦ï¼š</strong>æ•´åˆäº† simple-test.html çš„åŠŸèƒ½</li>
                <li><strong>æ ¸å¿ƒæ¨¡çµ„ï¼š</strong>æ•´åˆäº† test-suite.html å’Œ test-suite-fixed.html çš„åŠŸèƒ½</li>
                <li><strong>æ•ˆèƒ½ç›£æ§ï¼š</strong>æ•´åˆäº† performance-monitor.html çš„åŠŸèƒ½</li>
                <li><strong>å®Œæ•´æ¸¬è©¦ï¼š</strong>æ•´åˆäº† errorhandler-test.html ç­‰å…¶ä»–æ¸¬è©¦åŠŸèƒ½</li>
            </ul>
            <p style="margin-top: 15px; color: #6c757d;">
                ğŸ’¡ <strong>å»ºè­°ï¼š</strong>ä½¿ç”¨ã€Œç®¡ç†æ¸¬è©¦æª”æ¡ˆã€åŠŸèƒ½æ¸…ç†ä¸å†éœ€è¦çš„æ¸¬è©¦æª”æ¡ˆï¼Œä¿æŒå°ˆæ¡ˆæ•´æ½”ã€‚
            </p>
        </div>
    </div>

    <!-- è¼‰å…¥æ‰€æœ‰ä¾è³´ -->
    <script src="js/test/TestFramework.js"></script>
    <script src="js/test/TestDataFactory.js"></script>
    <script src="js/test/TestUtils.js"></script>
    <script src="js/core/EventBus.js"></script>
    <script src="js/core/ErrorHandler.js"></script>
    <script src="js/core/StorageService.js"></script>
    <script src="js/managers/CartManager.js"></script>

    <script>
        let isTestRunning = false;
        let currentTab = 'dependency';        // é ç±¤åˆ‡æ›
        function switchTab(tabName) {
            // åœæ­¢æ•ˆèƒ½ç›£æ§ï¼ˆå¦‚æœæ­£åœ¨é‹è¡Œï¼‰
            if (currentTab === 'performance' && performanceInterval) {
                stopPerformanceMonitor();
            }
            
            // ç§»é™¤æ‰€æœ‰ active é¡åˆ¥
            document.querySelectorAll('.nav-tab').forEach(tab => tab.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
            
            // æ·»åŠ  active é¡åˆ¥åˆ°ç•¶å‰é ç±¤
            document.querySelector(`[onclick="switchTab('${tabName}')"]`).classList.add('active');
            document.getElementById(`${tabName}-tab`).classList.add('active');
            
            currentTab = tabName;
        }

        // é€šç”¨æ—¥èªŒå‡½æ•¸
        function log(message, type = 'info', tabName = null) {
            const targetTab = tabName || currentTab;
            const logContainer = document.getElementById(`${targetTab}-log`);
            const div = document.createElement('div');
            div.className = `log-entry ${type}`;
            div.textContent = `${new Date().toLocaleTimeString()}: ${message}`;
            logContainer.appendChild(div);
            logContainer.scrollTop = logContainer.scrollHeight;
        }

        // æ¸…é™¤æ—¥èªŒ
        function clearLog(tabName) {
            const logContainer = document.getElementById(`${tabName}-log`);
            logContainer.innerHTML = `<div class="log-entry info">ğŸ¯ æ—¥èªŒå·²æ¸…é™¤</div>`;
        }

        // æ›´æ–°çµ±è¨ˆæ•¸æ“š
        function updateStats(tabName, results) {
            const statsContainer = document.getElementById(`${tabName}-stats`);
            if (statsContainer) {
                statsContainer.style.display = 'grid';
                
                document.getElementById(`${tabName}-passed`).textContent = results.passed;
                document.getElementById(`${tabName}-failed`).textContent = results.failed;
                document.getElementById(`${tabName}-total`).textContent = results.total;
                
                const passRate = results.total > 0 ? ((results.passed / results.total) * 100).toFixed(1) : 0;
                document.getElementById(`${tabName}-rate`).textContent = `${passRate}%`;
            }
        }        // ä¾è³´æª¢æŸ¥
        function checkDependencies() {
            const dependencies = [
                { name: 'TestFramework', check: () => typeof TestFramework !== 'undefined' },
                { name: 'TestDataFactory', check: () => typeof TestDataFactory !== 'undefined' },
                { name: 'TestUtils', check: () => typeof TestUtils !== 'undefined' },
                { name: 'EventBus', check: () => typeof EventBus !== 'undefined' },
                { name: 'ErrorHandler', check: () => typeof ErrorHandler !== 'undefined' },
                { name: 'AppError', check: () => typeof AppError !== 'undefined' },
                { name: 'ERROR_CODES', check: () => typeof ERROR_CODES !== 'undefined' },
                { 
                    name: 'CartManager', 
                    check: () => {
                        if (typeof CartManager === 'undefined') {
                            return false;
                        }
                        // å˜—è©¦å‰µå»ºå¯¦ä¾‹ä¾†æª¢æŸ¥æ˜¯å¦æ­£å¸¸å·¥ä½œ
                        try {
                            const cart = new CartManager();
                            return cart !== null;
                        } catch (error) {
                            console.error('CartManager å‰µå»ºå¤±æ•—:', error);
                            return false;
                        }
                    }
                },
                { name: 'LocalStorageService', check: () => typeof LocalStorageService !== 'undefined' },
                { name: 'jest mock', check: () => typeof jest !== 'undefined' },
                { name: 'describe/it/expect', check: () => typeof describe !== 'undefined' && typeof it !== 'undefined' && typeof expect !== 'undefined' }
            ];

            const grid = document.getElementById('dependency-grid');
            grid.innerHTML = '';

            clearLog('dependency');
            log('ğŸ” é–‹å§‹æª¢æŸ¥ä¾è³´ç’°å¢ƒ...', 'info', 'dependency');

            let allPassed = true;

            dependencies.forEach(dep => {
                const card = document.createElement('div');
                card.className = 'dependency-card';
                
                const isLoaded = dep.check();
                const statusClass = isLoaded ? 'success' : 'error';
                const cardClass = isLoaded ? 'loaded' : 'failed';
                
                card.classList.add(cardClass);
                card.innerHTML = `
                    <div>
                        <span class="status-indicator ${statusClass}"></span>
                        <strong>${dep.name}</strong>
                    </div>
                    <div style="margin-top: 5px; font-size: 0.9em; color: #666;">
                        ${isLoaded ? 'âœ… å·²è¼‰å…¥' : 'âŒ æœªè¼‰å…¥'}
                    </div>
                `;
                
                grid.appendChild(card);
                
                if (isLoaded) {
                    log(`âœ… ${dep.name} å¯ç”¨`, 'success', 'dependency');
                } else {
                    log(`âŒ ${dep.name} ä¸å¯ç”¨`, 'error', 'dependency');
                    allPassed = false;
                }
            });

            if (allPassed) {
                log('ğŸ‰ æ‰€æœ‰ä¾è³´æª¢æŸ¥é€šéï¼æ¸¬è©¦ç’°å¢ƒæº–å‚™å°±ç·’', 'success', 'dependency');
            } else {
                log('âš ï¸ éƒ¨åˆ†ä¾è³´å­˜åœ¨å•é¡Œï¼Œå»ºè­°æª¢æŸ¥æ§åˆ¶å°éŒ¯èª¤', 'warning', 'dependency');
            }
        }

        // åŸºæœ¬æ¸¬è©¦
        async function runBasicTests() {
            if (isTestRunning) return;
            isTestRunning = true;
            
            clearLog('basic');
            log('ğŸ§ª é–‹å§‹åŸºæœ¬åŠŸèƒ½æ¸¬è©¦...', 'info', 'basic');
            
            try {
                describe('åŸºæœ¬åŠŸèƒ½æ¸¬è©¦', () => {
                    it('expect.toBe æ‡‰è©²æ­£å¸¸å·¥ä½œ', () => {
                        expect(1 + 1).toBe(2);
                    });
                    
                    it('expect.toEqual æ‡‰è©²æ­£å¸¸å·¥ä½œ', () => {
                        expect({a: 1}).toEqual({a: 1});
                    });
                    
                    it('expect.toMatchObject æ‡‰è©²æ­£å¸¸å·¥ä½œ', () => {
                        const obj = { name: 'test', age: 25 };
                        expect(obj).toMatchObject({
                            name: 'test',
                            age: expect.any(Number)
                        });
                    });
                    
                    it('jest.fn mock æ‡‰è©²æ­£å¸¸å·¥ä½œ', () => {
                        const mockFn = jest.fn();
                        mockFn('hello');
                        expect(mockFn).toHaveBeenCalledWith('hello');
                    });
                });

                const results = await runTests();
                updateStats('basic', results);
                
                if (results.failed === 0) {
                    log('âœ… æ‰€æœ‰åŸºæœ¬æ¸¬è©¦é€šéï¼', 'success', 'basic');
                } else {
                    log(`âŒ ${results.failed} å€‹æ¸¬è©¦å¤±æ•—`, 'error', 'basic');
                    results.errors.forEach(error => {
                        log(`  - ${error.test}: ${error.error.message}`, 'error', 'basic');
                    });
                }
                
            } catch (error) {
                log(`âŒ åŸºæœ¬æ¸¬è©¦é‹è¡Œå¤±æ•—: ${error.message}`, 'error', 'basic');
                console.error(error);
            } finally {
                isTestRunning = false;
            }
        }

        // æ ¸å¿ƒæ¨¡çµ„æ¸¬è©¦
        async function runCoreTests() {
            if (isTestRunning) return;
            isTestRunning = true;
            
            clearLog('core');
            log('âš¡ é–‹å§‹æ ¸å¿ƒæ¨¡çµ„æ¸¬è©¦...', 'info', 'core');
            
            try {
                // EventBus æ¸¬è©¦
                describe('EventBus æ ¸å¿ƒæ¸¬è©¦', () => {
                    let eventBus;
                    
                    beforeEach(() => {
                        eventBus = EventBus.getInstance();
                        eventBus.clearAllListeners();
                    });
                    
                    it('æ‡‰è©²èƒ½å¤ è¨»å†Šå’Œè§¸ç™¼äº‹ä»¶', () => {
                        let received = false;
                        eventBus.on('test-event', () => { received = true; });
                        eventBus.emit('test-event');
                        expect(received).toBe(true);
                    });
                    
                    it('æ‡‰è©²èƒ½å¤ ç§»é™¤äº‹ä»¶ç›£è½å™¨', () => {
                        let count = 0;
                        const callback = () => { count++; };
                        eventBus.on('test-event', callback);
                        eventBus.emit('test-event');
                        eventBus.off('test-event', callback);
                        eventBus.emit('test-event');
                        expect(count).toBe(1);
                    });
                });

                // ErrorHandler æ¸¬è©¦
                describe('ErrorHandler æ ¸å¿ƒæ¸¬è©¦', () => {
                    let errorHandler;
                    
                    beforeEach(() => {
                        ErrorHandler.instance = null;
                        errorHandler = ErrorHandler.getInstance();
                        errorHandler.errorLog = [];
                    });
                    
                    it('æ‡‰è©²èƒ½å¤ è™•ç†éŒ¯èª¤', () => {
                        const testError = new Error('Test error');
                        errorHandler.handleError(testError);
                        expect(errorHandler.errorLog.length).toBe(1);
                    });
                    
                    it('æ‡‰è©²èƒ½å¤ åˆ†é¡éŒ¯èª¤', () => {
                        const appError = new AppError('Test', 'VALIDATION_TEST');
                        const category = errorHandler.categorizeError(appError);
                        expect(category).toBe('VALIDATION');
                    });
                });

                // CartManager æ¸¬è©¦
                describe('CartManager æ ¸å¿ƒæ¸¬è©¦', () => {
                    let cartManager;
                    let mockStorage;                    beforeEach(() => {
                        // å‰µå»ºç°¡å–®çš„ mock storage
                        mockStorage = {
                            getItem: jest.fn().mockReturnValue(null),
                            setItem: jest.fn().mockReturnValue(true),
                            removeItem: jest.fn().mockReturnValue(true),
                            clear: jest.fn().mockReturnValue(true)
                        };
                        
                        // å‰µå»ºæ–°çš„ CartManager å¯¦ä¾‹
                        cartManager = new CartManager(mockStorage);
                        
                        // å¼·åˆ¶é‡ç½®è³¼ç‰©è»Šç‹€æ…‹ç‚ºç©º
                        cartManager.items = [];                    });
                    
                    it('æ‡‰è©²åˆå§‹åŒ–ç©ºè³¼ç‰©è»Š', () => {
                        expect(Array.isArray(cartManager.items)).toBe(true);
                        expect(cartManager.items.length).toBe(0);
                    });
                    
                    it('æ‡‰è©²èƒ½å¤ æ·»åŠ å•†å“', () => {
                        const item = TestDataFactory.createMenuItem();
                        cartManager.addItem(item, 1);
                        expect(cartManager.items.length).toBe(1);
                        expect(cartManager.items[0].name).toBe(item.name);
                    });
                });

                const results = await runTests();
                updateStats('core', results);
                
                if (results.failed === 0) {
                    log('âœ… æ‰€æœ‰æ ¸å¿ƒæ¸¬è©¦é€šéï¼', 'success', 'core');
                } else {
                    log(`âŒ ${results.failed} å€‹æ¸¬è©¦å¤±æ•—`, 'error', 'core');
                    results.errors.forEach(error => {
                        log(`  - ${error.test}: ${error.error.message}`, 'error', 'core');
                    });
                }
                
            } catch (error) {
                log(`âŒ æ ¸å¿ƒæ¸¬è©¦é‹è¡Œå¤±æ•—: ${error.message}`, 'error', 'core');
                console.error(error);
            } finally {
                isTestRunning = false;
            }        }

        // æ•ˆèƒ½ç›£æ§è®Šæ•¸
        let performanceMonitor = null;
        let performanceInterval = null;
        let performanceData = {
            memory: 0,
            execution: 0,
            operations: 0,
            fps: 0
        };

        // é–‹å§‹æ•ˆèƒ½ç›£æ§
        function startPerformanceMonitor() {
            clearLog('performance');
            log('ğŸ“Š å•Ÿå‹•æ•ˆèƒ½ç›£æ§ç³»çµ±...', 'info', 'performance');
            
            // é¡¯ç¤ºçµ±è¨ˆå€åŸŸ
            document.getElementById('performance-stats').style.display = 'grid';
            
            // åˆå§‹åŒ–æ•ˆèƒ½ç›£æ§
            if (!window.performance || !window.performance.memory) {
                log('âš ï¸ ç€è¦½å™¨ä¸æ”¯æ´å®Œæ•´çš„æ•ˆèƒ½ç›£æ§ API', 'warning', 'performance');
            }
            
            performanceInterval = setInterval(() => {
                updatePerformanceStats();
            }, 1000);
            
            log('âœ… æ•ˆèƒ½ç›£æ§å·²å•Ÿå‹•', 'success', 'performance');
        }

        // æ›´æ–°æ•ˆèƒ½çµ±è¨ˆ
        function updatePerformanceStats() {
            try {
                // è¨˜æ†¶é«”ä½¿ç”¨é‡
                if (window.performance && window.performance.memory) {
                    const memoryMB = (window.performance.memory.usedJSHeapSize / 1024 / 1024).toFixed(2);
                    performanceData.memory = memoryMB;
                    document.getElementById('perf-memory').textContent = `${memoryMB} MB`;
                }
                
                // åŸ·è¡Œæ™‚é–“ï¼ˆæ¨¡æ“¬æ¸¬é‡ï¼‰
                const now = performance.now();
                performanceData.execution = now.toFixed(2);
                document.getElementById('perf-execution').textContent = `${now.toFixed(2)} ms`;
                
                // æ“ä½œæ¬¡æ•¸ï¼ˆæ¨¡æ“¬è¨ˆæ•¸ï¼‰
                performanceData.operations++;
                document.getElementById('perf-operations').textContent = performanceData.operations;
                
                // FPS ä¼°ç®—
                const fps = Math.round(1000 / 16.67); // å¤§ç´„ 60 FPS
                performanceData.fps = fps;
                document.getElementById('perf-fps').textContent = fps;
                
            } catch (error) {
                log(`âŒ æ•ˆèƒ½ç›£æ§æ›´æ–°å¤±æ•—: ${error.message}`, 'error', 'performance');
            }
        }

        // åŸ·è¡Œæ•ˆèƒ½æ¸¬è©¦
        async function runPerformanceTest() {
            if (isTestRunning) return;
            isTestRunning = true;
            
            log('ğŸš€ é–‹å§‹åŸ·è¡Œæ•ˆèƒ½æ¸¬è©¦...', 'info', 'performance');
            
            try {
                // æ¸¬è©¦ 1: EventBus æ•ˆèƒ½
                log('æ¸¬è©¦ EventBus äº‹ä»¶è™•ç†æ•ˆèƒ½...', 'info', 'performance');
                const eventBus = EventBus.getInstance();
                const startTime = performance.now();
                
                for (let i = 0; i < 1000; i++) {
                    eventBus.emit('test-event', { data: i });
                }
                
                const eventTime = performance.now() - startTime;
                log(`EventBus: 1000 å€‹äº‹ä»¶è™•ç†è€—æ™‚ ${eventTime.toFixed(2)}ms`, 'success', 'performance');
                  // æ¸¬è©¦ 2: CartManager æ•ˆèƒ½
                log('æ¸¬è©¦ CartManager å•†å“ç®¡ç†æ•ˆèƒ½...', 'info', 'performance');
                const cartStartTime = performance.now();
                
                // å‰µå»ºå…¨æ–°çš„ CartManager å¯¦ä¾‹ï¼Œä½¿ç”¨ mock storage ç¢ºä¿ä¹¾æ·¨ç‹€æ…‹
                const mockStorage = {
                    getItem: () => null,
                    setItem: () => true,
                    removeItem: () => true,
                    clear: () => true
                };                const cartManager = new CartManager(mockStorage);
                cartManager.items = []; // ç¢ºä¿ç©ºè³¼ç‰©è»Š
                
                for (let i = 0; i < 50; i++) {
                    const item = {
                        id: `item-${i}`, // ä½¿ç”¨å­—ç¬¦ä¸² ID é¿å… falsy å•é¡Œ
                        name: `å•†å“${i}`,
                        price: Math.random() * 100 + 1 // ç¢ºä¿åƒ¹æ ¼å¤§æ–¼ 0
                    };
                    cartManager.addItem(item, Math.floor(Math.random() * 5) + 1);
                }
                
                const cartTime = performance.now() - cartStartTime;
                log(`CartManager: 50 å€‹å•†å“æ“ä½œè€—æ™‚ ${cartTime.toFixed(2)}ms`, 'success', 'performance');
                
                // æ¸¬è©¦ 3: è¨˜æ†¶é«”ä½¿ç”¨
                if (window.performance && window.performance.memory) {
                    const memoryInfo = window.performance.memory;
                    log(`è¨˜æ†¶é«”ä½¿ç”¨: ${(memoryInfo.usedJSHeapSize / 1024 / 1024).toFixed(2)} MB`, 'info', 'performance');
                    log(`è¨˜æ†¶é«”é™åˆ¶: ${(memoryInfo.jsHeapSizeLimit / 1024 / 1024).toFixed(2)} MB`, 'info', 'performance');
                }
                
                log('âœ… æ•ˆèƒ½æ¸¬è©¦å®Œæˆ', 'success', 'performance');
                
            } catch (error) {
                log(`âŒ æ•ˆèƒ½æ¸¬è©¦å¤±æ•—: ${error.message}`, 'error', 'performance');
            } finally {
                isTestRunning = false;
            }
        }        // åœæ­¢æ•ˆèƒ½ç›£æ§
        function stopPerformanceMonitor() {
            if (performanceInterval) {
                clearInterval(performanceInterval);
                performanceInterval = null;
                log('â¹ï¸ æ•ˆèƒ½ç›£æ§å·²åœæ­¢', 'info', 'performance');
            }
        }

        // æ¸¬è©¦æª”æ¡ˆç®¡ç†åŠŸèƒ½
        let markedForDeletion = new Set();

        function showTestFileManagement() {
            const managementDiv = document.getElementById('test-file-management');
            managementDiv.style.display = managementDiv.style.display === 'none' ? 'block' : 'none';
            
            if (managementDiv.style.display === 'block') {
                log('ğŸ“ é¡¯ç¤ºæ¸¬è©¦æª”æ¡ˆç®¡ç†ä»‹é¢', 'info', 'full');
            }
        }

        function hideTestFileManagement() {
            document.getElementById('test-file-management').style.display = 'none';
            log('ğŸ“ éš±è—æ¸¬è©¦æª”æ¡ˆç®¡ç†ä»‹é¢', 'info', 'full');
        }

        function markForDeletion(fileName) {
            markedForDeletion.add(fileName);
            
            // æ›´æ–° UI
            const fileItems = document.querySelectorAll('.file-item');
            fileItems.forEach(item => {
                const nameSpan = item.querySelector('.file-name');
                if (nameSpan && nameSpan.textContent === fileName) {
                    item.classList.add('marked-for-deletion');
                    const button = item.querySelector('button');
                    if (button) {
                        button.textContent = 'å·²æ¨™è¨˜';
                        button.disabled = true;
                    }
                }
            });
            
            log(`ğŸ“ ${fileName} å·²æ¨™è¨˜ç‚ºå¾…åˆªé™¤`, 'warning', 'full');
        }

        function cleanupTestFiles() {
            if (markedForDeletion.size === 0) {
                log('âš ï¸ æ²’æœ‰æª”æ¡ˆè¢«æ¨™è¨˜ç‚ºåˆªé™¤', 'warning', 'full');
                return;
            }
            
            const confirmed = confirm(`ç¢ºå®šè¦æ¸…ç† ${markedForDeletion.size} å€‹æ¸¬è©¦æª”æ¡ˆå—ï¼Ÿ\n\næ¨™è¨˜çš„æª”æ¡ˆï¼š\n${Array.from(markedForDeletion).join('\n')}\n\næ³¨æ„ï¼šæ­¤æ“ä½œåªæ˜¯æ¨¡æ“¬ï¼Œå¯¦éš›æª”æ¡ˆéœ€è¦æ‰‹å‹•åˆªé™¤ã€‚`);
            
            if (confirmed) {
                markedForDeletion.forEach(fileName => {
                    log(`ğŸ—‘ï¸ æ¨¡æ“¬åˆªé™¤ï¼š${fileName}`, 'info', 'full');
                });
                
                log(`âœ… å·²æ¨™è¨˜ ${markedForDeletion.size} å€‹æª”æ¡ˆç‚ºå¾…æ¸…ç†`, 'success', 'full');
                log('ğŸ’¡ è«‹æ‰‹å‹•åˆªé™¤é€™äº›æª”æ¡ˆä»¥å®Œæˆæ¸…ç†', 'info', 'full');
                
                // æ¸…é™¤æ¨™è¨˜
                markedForDeletion.clear();
                
                // é‡ç½® UI
                const fileItems = document.querySelectorAll('.file-item');
                fileItems.forEach(item => {
                    item.classList.remove('marked-for-deletion');
                    const button = item.querySelector('button');
                    if (button) {
                        button.textContent = 'æ¨™è¨˜åˆªé™¤';
                        button.disabled = false;
                    }
                });
            }
        }

        // å®Œæ•´æ¸¬è©¦
        async function runFullTests() {
            if (isTestRunning) return;
            isTestRunning = true;
            
            clearLog('full');
            log('ğŸš€ é–‹å§‹å®Œæ•´æ¸¬è©¦å¥—ä»¶...', 'info', 'full');
            
            try {
                // è¼‰å…¥ä¸¦é‹è¡Œå¯¦éš›çš„æ¸¬è©¦æ–‡ä»¶
                // é€™è£¡å¯ä»¥åŒ…å«æ‰€æœ‰æ¸¬è©¦æ¡ˆä¾‹
                await runBasicTests();
                await runCoreTests();
                
                log('ğŸ‰ å®Œæ•´æ¸¬è©¦å¥—ä»¶åŸ·è¡Œå®Œæˆï¼', 'success', 'full');
                
            } catch (error) {
                log(`âŒ å®Œæ•´æ¸¬è©¦å¤±æ•—: ${error.message}`, 'error', 'full');
                console.error(error);
            } finally {
                isTestRunning = false;
            }
        }

        // ä¾åºåŸ·è¡Œæ‰€æœ‰æ¸¬è©¦
        async function runAllSequentially() {
            if (isTestRunning) return;
            
            const progressContainer = document.getElementById('full-progress-container');
            const progressBar = document.getElementById('full-progress');
            progressContainer.style.display = 'block';
            
            clearLog('full');
            log('ğŸ”„ é–‹å§‹ä¾åºåŸ·è¡Œæ‰€æœ‰æ¸¬è©¦...', 'info', 'full');
            
            try {
                // æ­¥é©Ÿ 1: æª¢æŸ¥ä¾è³´
                log('ğŸ“‹ æ­¥é©Ÿ 1/4: æª¢æŸ¥ä¾è³´...', 'info', 'full');
                checkDependencies();
                progressBar.style.width = '25%';
                await new Promise(resolve => setTimeout(resolve, 1000));
                
                // æ­¥é©Ÿ 2: åŸºæœ¬æ¸¬è©¦
                log('ğŸ“‹ æ­¥é©Ÿ 2/4: åŸºæœ¬æ¸¬è©¦...', 'info', 'full');
                await runBasicTests();
                progressBar.style.width = '50%';
                await new Promise(resolve => setTimeout(resolve, 1000));
                
                // æ­¥é©Ÿ 3: æ ¸å¿ƒæ¸¬è©¦
                log('ğŸ“‹ æ­¥é©Ÿ 3/4: æ ¸å¿ƒæ¨¡çµ„æ¸¬è©¦...', 'info', 'full');
                await runCoreTests();
                progressBar.style.width = '75%';
                await new Promise(resolve => setTimeout(resolve, 1000));
                
                // æ­¥é©Ÿ 4: å®Œæˆ
                log('ğŸ“‹ æ­¥é©Ÿ 4/4: æ¸¬è©¦å®Œæˆ', 'info', 'full');
                progressBar.style.width = '100%';
                
                log('ğŸ‰ æ‰€æœ‰æ¸¬è©¦åŸ·è¡Œå®Œæˆï¼', 'success', 'full');
                
            } catch (error) {
                log(`âŒ æ¸¬è©¦éç¨‹ä¸­ç™¼ç”ŸéŒ¯èª¤: ${error.message}`, 'error', 'full');
                console.error(error);
            } finally {
                setTimeout(() => {
                    progressContainer.style.display = 'none';
                    progressBar.style.width = '0%';
                }, 3000);
            }
        }

        // åˆå§‹åŒ–
        window.addEventListener('load', () => {
            log('ğŸ¯ OOP æ¸¬è©¦ä¸­å¿ƒå·²è¼‰å…¥ï¼Œè«‹é¸æ“‡æ¸¬è©¦é¡å‹é–‹å§‹', 'info', 'dependency');
            
            // è‡ªå‹•æª¢æŸ¥ä¾è³´
            setTimeout(() => {
                checkDependencies();
            }, 500);
        });
    </script>
</body>
</html>
