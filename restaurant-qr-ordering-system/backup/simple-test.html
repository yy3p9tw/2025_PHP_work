<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç°¡å–®æ¸¬è©¦</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .pass { color: green; }
        .fail { color: red; }
        .info { color: blue; }
    </style>
</head>
<body>
    <h1>ç°¡å–®æ¸¬è©¦</h1>
    <div id="output"></div>
    <button onclick="runSimpleTest()">é‹è¡Œæ¸¬è©¦</button>

    <!-- è¼‰å…¥ä¾è³´ -->
    <script src="js/test/TestFramework.js"></script>
    <script src="js/test/TestDataFactory.js"></script>
    <script src="js/test/TestUtils.js"></script>
    <script src="js/core/EventBus.js"></script>
    <script src="js/core/ErrorHandler.js"></script>
    <script src="js/core/StorageService.js"></script>
    <script src="js/managers/CartManager.js"></script>

    <script>
        function log(message, type = 'info') {
            const output = document.getElementById('output');
            const div = document.createElement('div');
            div.className = type;
            div.textContent = message;
            output.appendChild(div);
        }        async function runSimpleTest() {
            const output = document.getElementById('output');
            output.innerHTML = '';
            
            log('é–‹å§‹ç°¡å–®æ¸¬è©¦...', 'info');            try {
                // å…ˆæª¢æŸ¥ä¾è³´æ˜¯å¦è¼‰å…¥
                log('ğŸ” æª¢æŸ¥ä¾è³´è¼‰å…¥ç‹€æ…‹...', 'info');
                
                if (typeof ErrorHandler === 'undefined') {
                    log('âŒ ErrorHandler æœªè¼‰å…¥', 'fail');
                    return;
                } else {
                    log('âœ… ErrorHandler å·²è¼‰å…¥', 'pass');
                }
                
                if (typeof EventBus === 'undefined') {
                    log('âŒ EventBus æœªè¼‰å…¥', 'fail');
                    return;
                } else {
                    log('âœ… EventBus å·²è¼‰å…¥', 'pass');
                }
                
                if (typeof jest === 'undefined') {
                    log('âŒ jest mock æœªè¼‰å…¥', 'fail');
                    return;
                } else {
                    log('âœ… jest mock å·²è¼‰å…¥', 'pass');
                }
                
                log('âœ… æ‰€æœ‰æ ¸å¿ƒä¾è³´å·²è¼‰å…¥ï¼Œé–‹å§‹é‹è¡Œæ¸¬è©¦...', 'pass');

                // æ¸¬è©¦ 1: åŸºæœ¬ expect åŠŸèƒ½
                describe('åŸºæœ¬æ¸¬è©¦', () => {
                    it('should work with basic expect', () => {
                        expect(1 + 1).toBe(2);
                    });
                    
                    it('should work with array', () => {
                        expect([1, 2, 3]).toHaveLength(3);
                    });
                      it('should work with jest.fn', () => {
                        const mockFn = jest.fn();
                        mockFn('test');
                        expect(mockFn).toHaveBeenCalledWith('test');
                    });
                    
                    it('should work with toMatchObject', () => {
                        const obj = { name: 'test', age: 25, date: new Date() };
                        expect(obj).toMatchObject({
                            name: 'test',
                            age: expect.any(Number),
                            date: expect.any(Date)
                        });
                    });
                });

                // æ¸¬è©¦ 2: EventBus æ¸¬è©¦
                describe('EventBus æ¸¬è©¦', () => {
                    it('should emit and receive events', () => {
                        const eventBus = EventBus.getInstance();
                        let received = false;
                        
                        eventBus.on('test-event', () => {
                            received = true;
                        });
                        
                        eventBus.emit('test-event');
                        
                        expect(received).toBe(true);
                    });
                });

                // æ¸¬è©¦ 3: ErrorHandler æ¸¬è©¦
                describe('ErrorHandler æ¸¬è©¦', () => {
                    it('should handle errors', () => {
                        const errorHandler = ErrorHandler.getInstance();
                        const testError = new Error('Test error');
                        
                        // é€™ä¸æ‡‰è©²æ‹‹å‡ºéŒ¯èª¤
                        errorHandler.handleError(testError);
                        
                        expect(errorHandler.errorLog.length).toBe(1);
                    });
                });

                // é‹è¡Œæ¸¬è©¦
                const results = await runTests();
                
                log(`æ¸¬è©¦çµæœ: ${results.passed}/${results.total} é€šé`, 
                    results.failed === 0 ? 'pass' : 'fail');
                
                if (results.errors.length > 0) {
                    log('éŒ¯èª¤è©³æƒ…:', 'fail');
                    results.errors.forEach(error => {
                        log(`- ${error.test}: ${error.error.message}`, 'fail');
                    });
                }
                
            } catch (error) {
                log(`æ¸¬è©¦æ¡†æ¶éŒ¯èª¤: ${error.message}`, 'fail');
                console.error(error);
            }
        }
    </script>
</body>
</html>
