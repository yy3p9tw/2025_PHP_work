<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>依賴檢查</title>
</head>
<body>
    <h1>依賴檢查</h1>
    <div id="output"></div>

    <!-- 載入依賴 -->
    <script src="js/test/TestFramework.js"></script>
    <script src="js/test/TestDataFactory.js"></script>
    <script src="js/test/TestUtils.js"></script>
    <script src="js/core/EventBus.js"></script>
    <script src="js/core/ErrorHandler.js"></script>
    <script src="js/core/StorageService.js"></script>
    <script src="js/managers/CartManager.js"></script>

    <script>
        const output = document.getElementById('output');
        
        function log(message, type = 'info') {
            const div = document.createElement('div');
            div.style.color = type === 'error' ? 'red' : type === 'success' ? 'green' : 'black';
            div.textContent = `${new Date().toLocaleTimeString()}: ${message}`;
            output.appendChild(div);
        }

        // 檢查依賴
        try {
            log('檢查 TestFramework...', 'info');
            if (typeof TestFramework !== 'undefined') {
                log('✅ TestFramework 已載入', 'success');
            } else {
                log('❌ TestFramework 未載入', 'error');
            }

            log('檢查 TestDataFactory...', 'info');
            if (typeof TestDataFactory !== 'undefined') {
                log('✅ TestDataFactory 已載入', 'success');
            } else {
                log('❌ TestDataFactory 未載入', 'error');
            }

            log('檢查 TestUtils...', 'info');
            if (typeof TestUtils !== 'undefined') {
                log('✅ TestUtils 已載入', 'success');
            } else {
                log('❌ TestUtils 未載入', 'error');
            }

            log('檢查 EventBus...', 'info');
            if (typeof EventBus !== 'undefined') {
                const eventBus = EventBus.getInstance();
                log('✅ EventBus 已載入', 'success');
            } else {
                log('❌ EventBus 未載入', 'error');
            }

            log('檢查 ErrorHandler...', 'info');
            if (typeof ErrorHandler !== 'undefined') {
                const errorHandler = ErrorHandler.getInstance();
                log('✅ ErrorHandler 已載入', 'success');
            } else {
                log('❌ ErrorHandler 未載入', 'error');
            }

            log('檢查 LocalStorageService...', 'info');
            if (typeof LocalStorageService !== 'undefined') {
                const storage = new LocalStorageService();
                log('✅ LocalStorageService 已載入', 'success');
            } else {
                log('❌ LocalStorageService 未載入', 'error');
            }

            log('檢查 CartManager...', 'info');
            if (typeof CartManager !== 'undefined') {
                log('✅ CartManager 已載入', 'success');
            } else {
                log('❌ CartManager 未載入', 'error');
            }

            log('檢查全域 jest...', 'info');
            if (typeof jest !== 'undefined') {
                log('✅ jest mock 已載入', 'success');
            } else {
                log('❌ jest mock 未載入', 'error');
            }

            log('檢查全域測試函數...', 'info');
            if (typeof describe !== 'undefined' && typeof it !== 'undefined' && typeof expect !== 'undefined') {
                log('✅ 測試函數已載入', 'success');
            } else {
                log('❌ 測試函數未載入', 'error');
            }

            // 測試基本功能
            log('測試基本功能...', 'info');
            
            // 測試 EventBus
            const eventBus = EventBus.getInstance();
            let eventFired = false;
            eventBus.on('test-event', () => { eventFired = true; });
            eventBus.emit('test-event');
            
            if (eventFired) {
                log('✅ EventBus 基本功能正常', 'success');
            } else {
                log('❌ EventBus 基本功能異常', 'error');
            }

            // 測試 CartManager
            const storage = new LocalStorageService();
            const cartManager = new CartManager(storage);
            
            if (Array.isArray(cartManager.items)) {
                log('✅ CartManager 初始化正常', 'success');
            } else {
                log('❌ CartManager 初始化異常', 'error');
            }

            // 測試 Mock 功能
            const mockFn = jest.fn();
            mockFn('test');
            
            if (mockFn.calls.length === 1) {
                log('✅ Jest Mock 功能正常', 'success');
            } else {
                log('❌ Jest Mock 功能異常', 'error');
            }

            log('依賴檢查完成！', 'success');

        } catch (error) {
            log(`錯誤: ${error.message}`, 'error');
            console.error('詳細錯誤:', error);
        }
    </script>
</body>
</html>
