<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>管理端功能測試 - 餐廳點餐系統</title>
    <link rel="stylesheet" href="css/admin.css">
    <style>
        .test-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        
        .test-section {
            background: white;
            padding: 2rem;
            margin-bottom: 2rem;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        
        .test-section h2 {
            color: var(--primary-color);
            border-bottom: 2px solid var(--border-color);
            padding-bottom: 0.5rem;
            margin-bottom: 1.5rem;
        }
        
        .test-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 1rem;
        }
        
        .test-item {
            padding: 1.5rem;
            border: 1px solid var(--border-color);
            border-radius: 8px;
            text-align: center;
        }
        
        .test-item h3 {
            margin-top: 0;
            color: var(--primary-color);
        }
        
        .test-item p {
            color: #666;
            margin-bottom: 1rem;
        }
        
        .test-status {
            margin-top: 1rem;
            padding: 0.5rem;
            border-radius: 4px;
            font-weight: 500;
        }
        
        .test-status.success {
            background: #e8f5e8;
            color: #2e7d32;
        }
        
        .test-status.warning {
            background: #fff3e0;
            color: #f57c00;
        }
        
        .test-status.error {
            background: #ffebee;
            color: #d32f2f;
        }
        
        .quick-nav {
            background: var(--primary-color);
            color: white;
            padding: 1rem;
            border-radius: 8px;
            margin-bottom: 2rem;
        }
        
        .quick-nav h2 {
            margin-top: 0;
            color: white;
        }
        
        .nav-links {
            display: flex;
            flex-wrap: wrap;
            gap: 1rem;
        }
        
        .nav-links a {
            color: white;
            text-decoration: none;
            padding: 0.5rem 1rem;
            border: 1px solid white;
            border-radius: 4px;
            transition: all 0.2s ease;
        }
        
        .nav-links a:hover {
            background: white;
            color: var(--primary-color);
        }
    </style>
</head>
<body>
    <div class="test-container">
        <header class="quick-nav">
            <h2>🏪 管理端功能測試</h2>
            <div class="nav-links">
                <a href="admin/dashboard.html" target="_blank">主控台</a>
                <a href="admin/menu-manage.html" target="_blank">菜單管理</a>
                <a href="admin/orders.html" target="_blank">訂單管理</a>
                <a href="admin/reports.html" target="_blank">營業報表</a>
                <a href="admin/settings.html" target="_blank">系統設定</a>
                <a href="admin/permissions.html" target="_blank">權限管理</a>
            </div>
        </header>

        <!-- 系統設定測試 -->
        <section class="test-section">
            <h2>🔧 系統設定功能測試</h2>
            <div class="test-grid">
                <div class="test-item">
                    <h3>餐廳資訊管理</h3>
                    <p>測試餐廳基本資訊的儲存和載入</p>
                    <button class="btn btn-primary" onclick="testRestaurantInfo()">測試餐廳資訊</button>
                    <div id="restaurantInfoStatus" class="test-status"></div>
                </div>
                
                <div class="test-item">
                    <h3>用戶管理</h3>
                    <p>測試用戶新增、編輯、刪除功能</p>
                    <button class="btn btn-primary" onclick="testUserManagement()">測試用戶管理</button>
                    <div id="userManagementStatus" class="test-status"></div>
                </div>
                
                <div class="test-item">
                    <h3>系統配置</h3>
                    <p>測試系統設定的儲存和載入</p>
                    <button class="btn btn-primary" onclick="testSystemConfig()">測試系統配置</button>
                    <div id="systemConfigStatus" class="test-status"></div>
                </div>
                
                <div class="test-item">
                    <h3>桌號管理</h3>
                    <p>測試桌號設定和狀態管理</p>
                    <button class="btn btn-primary" onclick="testTableManagement()">測試桌號管理</button>
                    <div id="tableManagementStatus" class="test-status"></div>
                </div>
                
                <div class="test-item">
                    <h3>備份還原</h3>
                    <p>測試資料備份和還原功能</p>
                    <button class="btn btn-primary" onclick="testBackupRestore()">測試備份還原</button>
                    <div id="backupRestoreStatus" class="test-status"></div>
                </div>
                
                <div class="test-item">
                    <h3>安全設定</h3>
                    <p>測試安全相關設定和驗證</p>
                    <button class="btn btn-primary" onclick="testSecuritySettings()">測試安全設定</button>
                    <div id="securitySettingsStatus" class="test-status"></div>
                </div>
            </div>
        </section>

        <!-- 權限管理測試 -->
        <section class="test-section">
            <h2>🔐 權限管理功能測試</h2>
            <div class="test-grid">
                <div class="test-item">
                    <h3>角色管理</h3>
                    <p>測試角色新增、編輯、刪除功能</p>
                    <button class="btn btn-primary" onclick="testRoleManagement()">測試角色管理</button>
                    <div id="roleManagementStatus" class="test-status"></div>
                </div>
                
                <div class="test-item">
                    <h3>權限分配</h3>
                    <p>測試權限的分配和撤銷</p>
                    <button class="btn btn-primary" onclick="testPermissionAssignment()">測試權限分配</button>
                    <div id="permissionAssignmentStatus" class="test-status"></div>
                </div>
                
                <div class="test-item">
                    <h3>權限檢查</h3>
                    <p>測試權限驗證機制</p>
                    <button class="btn btn-primary" onclick="testPermissionCheck()">測試權限檢查</button>
                    <div id="permissionCheckStatus" class="test-status"></div>
                </div>
                
                <div class="test-item">
                    <h3>權限記錄</h3>
                    <p>測試權限變更記錄功能</p>
                    <button class="btn btn-primary" onclick="testPermissionLogs()">測試權限記錄</button>
                    <div id="permissionLogsStatus" class="test-status"></div>
                </div>
            </div>
        </section>

        <!-- 整合測試 -->
        <section class="test-section">
            <h2>🔄 整合功能測試</h2>
            <div class="test-grid">
                <div class="test-item">
                    <h3>資料同步測試</h3>
                    <p>測試各模組間的資料同步</p>
                    <button class="btn btn-primary" onclick="testDataSync()">測試資料同步</button>
                    <div id="dataSyncStatus" class="test-status"></div>
                </div>
                
                <div class="test-item">
                    <h3>本地儲存測試</h3>
                    <p>測試 localStorage 的使用</p>
                    <button class="btn btn-primary" onclick="testLocalStorage()">測試本地儲存</button>
                    <div id="localStorageStatus" class="test-status"></div>
                </div>
                
                <div class="test-item">
                    <h3>主題切換測試</h3>
                    <p>測試主題切換功能</p>
                    <button class="btn btn-primary" onclick="testThemeSwitch()">測試主題切換</button>
                    <div id="themeSwitchStatus" class="test-status"></div>
                </div>
                
                <div class="test-item">
                    <h3>全功能測試</h3>
                    <p>執行所有功能的完整測試</p>
                    <button class="btn btn-success" onclick="runAllTests()">執行全部測試</button>
                    <div id="allTestsStatus" class="test-status"></div>
                </div>
            </div>
        </section>

        <!-- 測試結果 -->
        <section class="test-section">
            <h2>📊 測試結果統計</h2>
            <div style="display: flex; justify-content: space-around; text-align: center;">
                <div>
                    <h3 id="passedCount">0</h3>
                    <p style="color: #2e7d32;">通過測試</p>
                </div>
                <div>
                    <h3 id="warningCount">0</h3>
                    <p style="color: #f57c00;">警告測試</p>
                </div>
                <div>
                    <h3 id="failedCount">0</h3>
                    <p style="color: #d32f2f;">失敗測試</p>
                </div>
                <div>
                    <h3 id="totalCount">0</h3>
                    <p style="color: #666;">總測試數</p>
                </div>
            </div>
        </section>
    </div>

    <script>
        // 測試統計
        let testStats = {
            passed: 0,
            warning: 0,
            failed: 0,
            total: 0
        };

        // 更新測試狀態
        function updateTestStatus(elementId, status, message) {
            const element = document.getElementById(elementId);
            element.className = `test-status ${status}`;
            element.textContent = message;
            
            testStats.total++;
            testStats[status]++;
            updateTestStats();
        }

        function updateTestStats() {
            document.getElementById('passedCount').textContent = testStats.passed;
            document.getElementById('warningCount').textContent = testStats.warning;
            document.getElementById('failedCount').textContent = testStats.failed;
            document.getElementById('totalCount').textContent = testStats.total;
        }

        // 系統設定測試
        function testRestaurantInfo() {
            try {
                const testData = {
                    name: '測試餐廳',
                    phone: '02-1234-5678',
                    address: '台北市測試區測試路123號'
                };
                
                localStorage.setItem('restaurantSettings', JSON.stringify({ restaurantInfo: testData }));
                const saved = JSON.parse(localStorage.getItem('restaurantSettings'));
                
                if (saved.restaurantInfo.name === testData.name) {
                    updateTestStatus('restaurantInfoStatus', 'success', '✓ 餐廳資訊儲存/載入正常');
                } else {
                    updateTestStatus('restaurantInfoStatus', 'error', '✗ 資料儲存失敗');
                }
            } catch (error) {
                updateTestStatus('restaurantInfoStatus', 'error', '✗ 測試執行錯誤: ' + error.message);
            }
        }

        function testUserManagement() {
            try {
                const testUsers = [
                    { username: 'test1', role: 'admin', status: 'active' },
                    { username: 'test2', role: 'staff', status: 'active' }
                ];
                
                localStorage.setItem('restaurantUsers', JSON.stringify(testUsers));
                const saved = JSON.parse(localStorage.getItem('restaurantUsers'));
                
                if (saved.length === 2 && saved[0].username === 'test1') {
                    updateTestStatus('userManagementStatus', 'success', '✓ 用戶管理功能正常');
                } else {
                    updateTestStatus('userManagementStatus', 'error', '✗ 用戶資料處理失敗');
                }
            } catch (error) {
                updateTestStatus('userManagementStatus', 'error', '✗ 測試執行錯誤: ' + error.message);
            }
        }

        function testSystemConfig() {
            try {
                const testConfig = {
                    theme: 'dark',
                    language: 'zh-TW',
                    autoAcceptOrders: true
                };
                
                localStorage.setItem('restaurantSettings', JSON.stringify({ systemConfig: testConfig }));
                const saved = JSON.parse(localStorage.getItem('restaurantSettings'));
                
                if (saved.systemConfig.theme === 'dark') {
                    updateTestStatus('systemConfigStatus', 'success', '✓ 系統配置儲存正常');
                } else {
                    updateTestStatus('systemConfigStatus', 'error', '✗ 配置儲存失敗');
                }
            } catch (error) {
                updateTestStatus('systemConfigStatus', 'error', '✗ 測試執行錯誤: ' + error.message);
            }
        }

        function testTableManagement() {
            try {
                const testTableConfig = {
                    maxTableNumber: 50,
                    tablePrefix: 'A'
                };
                
                localStorage.setItem('restaurantSettings', JSON.stringify({ tableConfig: testTableConfig }));
                const saved = JSON.parse(localStorage.getItem('restaurantSettings'));
                
                if (saved.tableConfig.maxTableNumber === 50) {
                    updateTestStatus('tableManagementStatus', 'success', '✓ 桌號管理功能正常');
                } else {
                    updateTestStatus('tableManagementStatus', 'error', '✗ 桌號設定失敗');
                }
            } catch (error) {
                updateTestStatus('tableManagementStatus', 'error', '✗ 測試執行錯誤: ' + error.message);
            }
        }

        function testBackupRestore() {
            try {
                const testBackup = {
                    timestamp: new Date().toISOString(),
                    data: { test: 'backup data' }
                };
                
                const backups = [testBackup];
                localStorage.setItem('backupHistory', JSON.stringify(backups));
                const saved = JSON.parse(localStorage.getItem('backupHistory'));
                
                if (saved.length === 1 && saved[0].data.test === 'backup data') {
                    updateTestStatus('backupRestoreStatus', 'success', '✓ 備份還原功能正常');
                } else {
                    updateTestStatus('backupRestoreStatus', 'error', '✗ 備份資料處理失敗');
                }
            } catch (error) {
                updateTestStatus('backupRestoreStatus', 'error', '✗ 測試執行錯誤: ' + error.message);
            }
        }

        function testSecuritySettings() {
            try {
                const testSecurity = {
                    minPasswordLength: 8,
                    requireUppercase: true,
                    maxLoginAttempts: 5
                };
                
                localStorage.setItem('restaurantSettings', JSON.stringify({ securitySettings: testSecurity }));
                const saved = JSON.parse(localStorage.getItem('restaurantSettings'));
                
                if (saved.securitySettings.minPasswordLength === 8) {
                    updateTestStatus('securitySettingsStatus', 'success', '✓ 安全設定功能正常');
                } else {
                    updateTestStatus('securitySettingsStatus', 'error', '✗ 安全設定失敗');
                }
            } catch (error) {
                updateTestStatus('securitySettingsStatus', 'error', '✗ 測試執行錯誤: ' + error.message);
            }
        }

        // 權限管理測試
        function testRoleManagement() {
            try {
                const testRoles = [
                    { id: 'admin', name: '管理員', permissions: ['*'] },
                    { id: 'test_role', name: '測試角色', permissions: ['menu_view'] }
                ];
                
                localStorage.setItem('userRoles', JSON.stringify(testRoles));
                const saved = JSON.parse(localStorage.getItem('userRoles'));
                
                if (saved.length === 2 && saved[1].name === '測試角色') {
                    updateTestStatus('roleManagementStatus', 'success', '✓ 角色管理功能正常');
                } else {
                    updateTestStatus('roleManagementStatus', 'error', '✗ 角色資料處理失敗');
                }
            } catch (error) {
                updateTestStatus('roleManagementStatus', 'error', '✗ 測試執行錯誤: ' + error.message);
            }
        }

        function testPermissionAssignment() {
            try {
                const testPermissions = {
                    'test_user': ['menu_view', 'order_process']
                };
                
                localStorage.setItem('userPermissions', JSON.stringify(testPermissions));
                const saved = JSON.parse(localStorage.getItem('userPermissions'));
                
                if (saved.test_user && saved.test_user.includes('menu_view')) {
                    updateTestStatus('permissionAssignmentStatus', 'success', '✓ 權限分配功能正常');
                } else {
                    updateTestStatus('permissionAssignmentStatus', 'error', '✗ 權限分配失敗');
                }
            } catch (error) {
                updateTestStatus('permissionAssignmentStatus', 'error', '✗ 測試執行錯誤: ' + error.message);
            }
        }

        function testPermissionCheck() {
            try {
                // 模擬權限檢查邏輯
                const hasPermission = (user, permission) => {
                    const userPermissions = JSON.parse(localStorage.getItem('userPermissions') || '{}');
                    return userPermissions[user] && userPermissions[user].includes(permission);
                };
                
                if (hasPermission('test_user', 'menu_view')) {
                    updateTestStatus('permissionCheckStatus', 'success', '✓ 權限檢查機制正常');
                } else {
                    updateTestStatus('permissionCheckStatus', 'warning', '◐ 權限檢查需要完善');
                }
            } catch (error) {
                updateTestStatus('permissionCheckStatus', 'error', '✗ 測試執行錯誤: ' + error.message);
            }
        }

        function testPermissionLogs() {
            try {
                const testLogs = [
                    {
                        id: 1,
                        timestamp: new Date().toISOString(),
                        user: 'admin',
                        action: 'grant',
                        target: 'test_user',
                        description: '授予菜單查看權限'
                    }
                ];
                
                localStorage.setItem('permissionLogs', JSON.stringify(testLogs));
                const saved = JSON.parse(localStorage.getItem('permissionLogs'));
                
                if (saved.length === 1 && saved[0].action === 'grant') {
                    updateTestStatus('permissionLogsStatus', 'success', '✓ 權限記錄功能正常');
                } else {
                    updateTestStatus('permissionLogsStatus', 'error', '✗ 權限記錄失敗');
                }
            } catch (error) {
                updateTestStatus('permissionLogsStatus', 'error', '✗ 測試執行錯誤: ' + error.message);
            }
        }

        // 整合測試
        function testDataSync() {
            try {
                // 測試資料同步
                const menuData = JSON.parse(localStorage.getItem('menuItems') || '[]');
                const userData = JSON.parse(localStorage.getItem('restaurantUsers') || '[]');
                
                updateTestStatus('dataSyncStatus', 'success', '✓ 資料同步功能正常');
            } catch (error) {
                updateTestStatus('dataSyncStatus', 'error', '✗ 資料同步錯誤: ' + error.message);
            }
        }

        function testLocalStorage() {
            try {
                const testKey = 'test_storage';
                const testValue = { test: true, timestamp: Date.now() };
                
                localStorage.setItem(testKey, JSON.stringify(testValue));
                const retrieved = JSON.parse(localStorage.getItem(testKey));
                localStorage.removeItem(testKey);
                
                if (retrieved.test === true) {
                    updateTestStatus('localStorageStatus', 'success', '✓ 本地儲存功能正常');
                } else {
                    updateTestStatus('localStorageStatus', 'error', '✗ 本地儲存失敗');
                }
            } catch (error) {
                updateTestStatus('localStorageStatus', 'error', '✗ 本地儲存錯誤: ' + error.message);
            }
        }

        function testThemeSwitch() {
            try {
                // 測試主題切換
                document.body.classList.add('theme-dark');
                const hasDarkTheme = document.body.classList.contains('theme-dark');
                document.body.classList.remove('theme-dark');
                
                if (hasDarkTheme) {
                    updateTestStatus('themeSwitchStatus', 'success', '✓ 主題切換功能正常');
                } else {
                    updateTestStatus('themeSwitchStatus', 'error', '✗ 主題切換失敗');
                }
            } catch (error) {
                updateTestStatus('themeSwitchStatus', 'error', '✗ 主題切換錯誤: ' + error.message);
            }
        }

        function runAllTests() {
            // 重置統計
            testStats = { passed: 0, warning: 0, failed: 0, total: 0 };
            updateTestStats();
            
            // 執行所有測試
            setTimeout(() => testRestaurantInfo(), 100);
            setTimeout(() => testUserManagement(), 200);
            setTimeout(() => testSystemConfig(), 300);
            setTimeout(() => testTableManagement(), 400);
            setTimeout(() => testBackupRestore(), 500);
            setTimeout(() => testSecuritySettings(), 600);
            setTimeout(() => testRoleManagement(), 700);
            setTimeout(() => testPermissionAssignment(), 800);
            setTimeout(() => testPermissionCheck(), 900);
            setTimeout(() => testPermissionLogs(), 1000);
            setTimeout(() => testDataSync(), 1100);
            setTimeout(() => testLocalStorage(), 1200);
            setTimeout(() => testThemeSwitch(), 1300);
            
            setTimeout(() => {
                const successRate = Math.round((testStats.passed / testStats.total) * 100);
                updateTestStatus('allTestsStatus', 'success', `✓ 全部測試完成 (成功率: ${successRate}%)`);
            }, 1500);
        }

        // 頁面載入時顯示提示
        document.addEventListener('DOMContentLoaded', () => {
            console.log('管理端功能測試頁面已載入');
            console.log('點擊各個測試按鈕來驗證功能');
        });
    </script>
</body>
</html>
