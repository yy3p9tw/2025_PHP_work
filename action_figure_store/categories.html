<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title id="page-title">商品分類 - 公仔天堂</title>
    <meta name="description" content="瀏覽公仔天堂的商品分類，找到您最愛的動漫、遊戲、電影公仔">
    <link rel="icon" type="image/svg+xml" href="favicon.svg">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="assets/css/colors.css">
    <link rel="stylesheet" href="assets/css/style.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700;900&display=swap" rel="stylesheet">
    <style>
        /* 分類頁面專用樣式 - 使用統一配色 */
        .category-header {
            background: var(--primary-gradient);
            color: var(--white) !important;
            padding: 4rem 0 2rem;
            position: relative;
            overflow: hidden;
        }
        
        .category-header * {
            color: var(--white) !important;
        }
        
        .category-header a {
            color: var(--gray-200) !important;
        }
        
        .category-header a:hover {
            color: var(--white) !important;
        }
        
        .category-header::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><defs><pattern id="grid" width="10" height="10" patternUnits="userSpaceOnUse"><path d="M 10 0 L 0 0 0 10" fill="none" stroke="rgba(255,255,255,0.1)" stroke-width="0.5"/></pattern></defs><rect width="100" height="100" fill="url(%23grid)"/></svg>');
            opacity: 0.3;
        }
        
        .filter-sidebar {
            background: var(--bg-card);
            border: 1px solid var(--border-color);
            border-radius: var(--radius-lg);
            padding: 2rem;
            margin-bottom: 2rem;
            box-shadow: var(--shadow-sm);
            position: sticky;
            top: 100px;
        }
        
        .filter-group {
            margin-bottom: 2rem;
            padding-bottom: 1.5rem;
            border-bottom: 1px solid var(--border-light);
        }
        
        .filter-group:last-child {
            border-bottom: none;
            margin-bottom: 0;
        }
        
        .filter-title {
            font-weight: 600;
            margin-bottom: 1rem;
            color: var(--text-primary);
            font-size: 1.1rem;
        }
        
        .form-check-input:checked {
            background-color: var(--primary-color);
            border-color: var(--primary-color);
        }
        
        .form-check-label {
            color: var(--text-secondary);
            transition: var(--transition-fast);
        }
        
        .form-check-label:hover {
            color: var(--primary-color);
        }
        
        .sort-controls {
            background: var(--bg-card);
            border: 1px solid var(--border-color);
            border-radius: var(--radius-lg);
            padding: 1.5rem;
            margin-bottom: 2rem;
            box-shadow: var(--shadow-sm);
        }
        
        .view-toggle {
            border: 2px solid var(--border-color);
            background: transparent;
            padding: 0.75rem;
            border-radius: var(--radius-md);
            color: var(--text-secondary);
            transition: var(--transition-fast);
        }
        
        .view-toggle.active {
            background: var(--primary-gradient);
            color: var(--text-white);
            border-color: var(--primary-color);
        }
        
        .view-toggle:hover {
            border-color: var(--primary-color);
            color: var(--primary-color);
        }
        
        .product-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 2rem;
        }
        
        .product-list .card {
            margin-bottom: 1.5rem;
        }
        
        .product-image {
            height: 280px;
            object-fit: cover;
            width: 100%;
            transition: var(--transition-normal);
        }
        
        .filter-group {
            margin-bottom: 1.5rem;
        }
        
        .filter-title {
            font-weight: 600;
            margin-bottom: 0.75rem;
            color: #495057;
        }
        
        .sort-controls {
            background: white;
            border-radius: 8px;
            padding: 1rem;
            margin-bottom: 1.5rem;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        
        .view-toggle {
            border: none;
            background: none;
            padding: 0.5rem;
            border-radius: 6px;
            color: #6c757d;
        }
        
        .view-toggle.active {
            background: #007bff;
            color: white;
        }
    </style>
</head>
<body>
    <!-- 導覽列 -->
    <div id="navbar-placeholder"></div>

    <!-- 分類標題區 -->
    <section class="category-header">
        <div class="container">
            <nav aria-label="breadcrumb" class="mb-3">
                <ol class="breadcrumb mb-0" id="breadcrumb-nav">
                    <li class="breadcrumb-item"><a href="index.html" class="text-white-50">首頁</a></li>
                    <li class="breadcrumb-item active text-white" id="current-category">所有商品</li>
                </ol>
            </nav>
            <h1 class="display-4 mb-2" id="category-title">所有商品</h1>
            <p class="lead mb-0" id="category-description">探索我們精選的公仔收藏</p>
        </div>
    </section>

    <!-- 主要內容 -->
    <main class="container my-5">
        <div class="row">
            <!-- 側邊欄篩選器 -->
            <div class="col-lg-3">
                <div class="filter-sidebar">
                    <h5 class="mb-3">
                        <i class="bi bi-funnel me-2"></i>篩選條件
                    </h5>

                    <!-- 分類篩選 -->
                    <div class="filter-group">
                        <div class="filter-title">商品分類</div>
                        <div id="category-filters">
                            <div class="text-center py-3">
                                <div class="spinner-border spinner-border-sm text-primary" role="status"></div>
                                <div class="small text-muted mt-2">載入中...</div>
                            </div>
                        </div>
                    </div>

                    <!-- 價格篩選 -->
                    <div class="filter-group">
                        <div class="filter-title">價格範圍</div>
                        <div class="row g-2">
                            <div class="col-6">
                                <input type="number" 
                                       class="form-control form-control-sm" 
                                       id="price-min" 
                                       placeholder="最低價"
                                       min="0">
                            </div>
                            <div class="col-6">
                                <input type="number" 
                                       class="form-control form-control-sm" 
                                       id="price-max" 
                                       placeholder="最高價"
                                       min="0">
                            </div>
                        </div>
                        <button class="btn btn-outline-primary btn-sm w-100 mt-2" onclick="applyPriceFilter()">
                            套用價格篩選
                        </button>
                    </div>

                    <!-- 搜尋 -->
                    <div class="filter-group">
                        <div class="filter-title">搜尋商品</div>
                        <div class="input-group">
                            <input type="text" 
                                   class="form-control form-control-sm" 
                                   id="search-input" 
                                   placeholder="搜尋商品名稱...">
                            <button class="btn btn-outline-primary btn-sm" onclick="applySearch()">
                                <i class="bi bi-search"></i>
                            </button>
                        </div>
                    </div>

                    <!-- 重置按鈕 -->
                    <button class="btn btn-outline-secondary w-100" onclick="resetFilters()">
                        <i class="bi bi-arrow-clockwise me-1"></i>重置篩選
                    </button>
                </div>

                <!-- 已套用的篩選標籤 -->
                <div id="active-filters" class="mt-3" style="display: none;">
                    <h6>已套用篩選：</h6>
                    <div id="filter-tags"></div>
                </div>
            </div>

            <!-- 商品列表區域 -->
            <div class="col-lg-9">
                <!-- 排序和檢視控制 -->
                <div class="sort-controls">
                    <div class="row align-items-center">
                        <div class="col-md-6">
                            <div class="d-flex align-items-center">
                                <label for="sort-select" class="form-label me-2 mb-0">排序：</label>
                                <select class="form-select form-select-sm" id="sort-select" onchange="applySorting()">
                                    <option value="newest">最新上架</option>
                                    <option value="oldest">最舊上架</option>
                                    <option value="price-asc">價格：低到高</option>
                                    <option value="price-desc">價格：高到低</option>
                                    <option value="name-asc">名稱：A到Z</option>
                                    <option value="name-desc">名稱：Z到A</option>
                                </select>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="d-flex justify-content-md-end align-items-center">
                                <span class="text-muted me-3" id="result-count">載入中...</span>
                                <div class="btn-group btn-group-sm" role="group">
                                    <button type="button" 
                                            class="view-toggle active" 
                                            id="grid-view" 
                                            onclick="switchView('grid')">
                                        <i class="bi bi-grid"></i>
                                    </button>
                                    <button type="button" 
                                            class="view-toggle" 
                                            id="list-view" 
                                            onclick="switchView('list')">
                                        <i class="bi bi-list"></i>
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 載入中指示器 -->
                <div id="loading-spinner" class="loading-spinner">
                    <div class="text-center">
                        <div class="spinner-border text-primary" role="status">
                            <span class="visually-hidden">載入中...</span>
                        </div>
                        <div class="mt-2 text-muted">載入商品資料...</div>
                    </div>
                </div>

                <!-- 商品容器 -->
                <div id="products-container" class="product-grid" style="display: none;"></div>

                <!-- 分頁導航 -->
                <div id="pagination-container" class="mt-4 d-flex justify-content-center"></div>
            </div>
        </div>
    </main>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    
    <!-- 預載入 navbar -->
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            console.log('分類頁面開始載入 navbar');
            
            // 載入 navbar
            fetch('navbar.html')
                .then(response => response.text())
                .then(html => {
                    console.log('分類頁面 navbar HTML 載入完成');
                    document.getElementById('navbar-placeholder').innerHTML = html;
                    
                    // 立即載入分類選單
                    setTimeout(() => {
                        console.log('分類頁面開始載入分類選單');
                        
                        const categoryMenu = document.getElementById('category-dropdown-menu');
                        if (categoryMenu) {
                            fetch('api/categories.php')
                                .then(response => response.json())
                                .then(data => {
                                    console.log('分類頁面分類 API 回應:', data);
                                    
                                    if (data.success && data.categories) {
                                        let html = '<li><a class="dropdown-item" href="categories.html">所有商品</a></li>';
                                        
                                        if (data.categories && data.categories.length > 0) {
                                            html += '<li><hr class="dropdown-divider"></li>';
                                            
                                            data.categories.forEach(category => {
                                                html += `
                                                    <li>
                                                        <a class="dropdown-item" href="categories.html?category_id=${category.id}&name=${encodeURIComponent(category.name)}">
                                                            ${category.name}
                                                        </a>
                                                    </li>
                                                `;
                                            });
                                        }
                                        
                                        categoryMenu.innerHTML = html;
                                        console.log('分類頁面分類選單載入完成');
                                    } else {
                                        console.error('分類頁面載入分類失敗:', data);
                                        categoryMenu.innerHTML = '<li><a class="dropdown-item text-danger" href="#">載入失敗</a></li>';
                                    }
                                })
                                .catch(error => {
                                    console.error('分類頁面分類 API 錯誤:', error);
                                    if (categoryMenu) {
                                        categoryMenu.innerHTML = '<li><a class="dropdown-item text-danger" href="#">網路錯誤</a></li>';
                                    }
                                });
                        } else {
                            console.error('分類頁面找不到分類選單容器');
                        }
                    }, 200);
                })
                .catch(error => {
                    console.error('分類頁面載入 navbar 失敗:', error);
                });
        });
    </script>
    
    <!-- 自定義 JS -->
    <script src="assets/js/categories.js"></script>
</body>
</html>
